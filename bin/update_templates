#! /usr/bin/env node_modules/.bin/coffee

child_process= require 'child_process'

command = "npm run-script update_templates";
interval = process.env.npm_package_config_template_update_interval;

run_process = () ->
  child_process.execFile('bash', ["-c", command],[], {}, dump_streams);

dump_streams = (err, stderr, stdout) ->
  console.log(stdout);
  if (err)
    console.error("Error from child:\n" + JSON.stringify(err));
  console.error(stderr);
  setInterval(run_process, interval);


console.log("starting " + process.argv[0] + " with command '" + command + "' at interval " + interval);
run_process();
