<!doctype html>
<html ng-app="epiquery-tool">
<head>
<title></title>
  <style>
    results { width: 90%; margin-left: auto; margin-right:auto; }
  </style>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="/js/lodash.min.js" type="text/javascript"></script>
  <script type="text/javascript">
    _.extend($,{
      parseQueryString: function(str){
        var nvpair = {};
        var qs = str || window.location.search.replace('?', '');
        var pairs = qs.split('&');
        $.each(pairs, function(i, v){
          var pair = v.split('=');
          nvpair[pair[0]] = pair[1];
        });
        return nvpair;
      }
    });
    var angApp = angular.module('epiquery-tool', []);

    function QueryController($scope, $http){
      $http.jsonp("http://localhost:8000/results1.js?callback=JSON_CALLBACK").
      success(function(results) { console.log("success"); $scope.response=results; }).
      error(function(data, status, headers, config) { console.log("error"); console.log(data);});
    }
  </script>
</head>
<body>
  <span ng-controller="QueryController">
    <table ng-repeat="resultSet in response.resultSets">
      <caption>Elements: {{resultSet.metadata.rowCount}}</caption>
      <tr>
        <!-- loop through one row, so we can print the names as the header -->
        <th ng-repeat="name in resultSet.metadata.columnNames">
          {{name}}
        </th>
      </tr>
      <tr ng-repeat="column in resultSet.rows">
        <td>{{column.id}}</td>
        <td>{{column.name}}</td>
      </tr>
    </table>
  </span>
</body>
</html>
